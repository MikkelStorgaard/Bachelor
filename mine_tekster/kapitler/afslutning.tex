\section{Discussion of results}
\label{sec:final_section}

Both the type aliasing system and the basic structure implementation developed
during this project, has been designed around a set of interference rules.
Tests were designed to measure whether these rules were obeyed by the actual
implementation of the type system.
For both type aliasing and structures, the final iterations of program showed
that the implementations \textit{did} work as defined in the interference rules.
\\
\\
As my final implementations of the two first features failed neither any of the
feature-specific tests, nor any test in the Futhark test suite, or any of the
Futhark benchmark programs\cite{Futhark_benchmarks}, I \textit{will} claim, that
it is possible to extend the Futhark language, and that I am able to succesfully
add features to the code base.
\\
\\
These results suggests that the two remaining features should be quite possible
to implement as well:\\
Although the module signatures were not implemented in time for this report, all the information
needed to perform a signature check at compile time, is present. A correct
implementation is indeed just a question of writing a function, that verifies
the type signature of a declaration correctly.
\\
The implementation of the functor functionality itself was not completed either,
but a tentative implementation has been described in this report.
As the tentative implementation has been described from a good background knowledge
of the relevant parts of the Futhark implementation, I see no immediate reason,
that this implementation should not work \emph barring a total redesign of
the Futhark implementation, outside of my control.
\\

\subsection{Method}
\label{subsec:method}
The developement of the features implemented during this project has generally
followed three phases.\\
For each of the features, I have initially sat down with both my supervisor and
my ``code supervisor'' to discuss both the behaviour, and the implementation of
the features. After having decided on which features we would like each part of
the project to exhibit, we have shortly discussed a strategy for implementing
this.

After these initial design meetings, I have been implementing the designs in the
Futhark compiler itself. As the extensions I have made to Futhark have been
implemented all the way into the Futhark parser, the step from initial code
changes to a test-driven developement has been slightly long.
\\
In the beginning of this project, it took me several weeks from the first change to the program, until
I had code that would compile again. This was mostly caused by me being very
new to the Futhark code base. Over time, this was definitely alleviated by me
becoming much more confident in Futhark developement.
\\
At a certain point in the developement cycle of each feature, the implementation
reached an almost finished state: The code would compile, and the initial
parsing tests for the given feature would compile correctly. At this point, I
could commence actual test driven developement:
\\
\\
My method was now to define tests that corresponded to the interference rules
which were declared for the feature in question. Whilst the code \textit{would}
compile at this stage, I reiterated on the implementation to fix mistakes in the
code.
I.e. type checking would perform correctly in a test program, but the program
would exhibit behaviour that was not defined by an interference rule, nor
desirable in the context of program.
\\
Any number of tests could be written to test a feature implementation, but I
concentrated mainly on white box testing, which are attempts to write tests that
breaks the implementation, or makes the implementation show undefined behaviour.
\\
\\
After completing the implementation of a feature, I would document the addition
to the Futhark language in the Futhark language reference documents, and merge
the git feature branch with master.
\subsubsection{Alternatives to the chosen method}
The implementation of Futhark modules was chosen to be done directly in the
Futhark code base.
However, we considered another option in the beginning of the project.
Futhark modules could have been implemented as a prototype instead, using an
intermediate compiler for the modules specifically.
\\
\\
Instead of writing modules directly in a Futhark source file, the user would
write Futhark modules in an intermediate language.
This would then be compiled into a normal Futhark source file, without any structures, modules or type aliases.
\\
The benefits of this method would have been a larger degree of freedom in the
implementation: I would have been able to define my an intermediate language for Futhark
modules, and I could have implemented the intermediate language in a language of
my own choice, other than Haskell.
\\
\\
I decided against this, because seperating the module compiler from the Futhark
compiler would demand continued maintenance on the module compiler, whenever the
Futhark language definition changed.\\
Furthermore, I decided to develop the modules in Futhark itself, so I could
benefit from Troels Henriksens knowledge of the Futhark code base, and get more
comfortable with advanced functional programming concepts, such as monads.

\subsection{Conclusion}
Implementing a simple Standard ML style module system is not only theoretically
possible, but should be within reach of the Futhark project, given a couple of
weeks' more of developement time.
\\
At the time of this report, it has not been finished solely due to time constraints.
\\
\\

\subsection{Acknowledgements}
\label{subsec:acknow}
First and foremost, I would like to thank my supervisor \textit{Martin Elsman}, who have
been helpful with advice, theoretical education in relation to defining
environments, and the interference rules hereof.
\\
\\
I would like to thank \textit{Troels Henriksen}, my ``code supervisor'' on this
project. As Troels is one of, if not \textit{the}, head developer of Futhark, he
has been an invaluable source of sound design advice and code reviews on my Futhark
development.
\\
\\
Finally, I like would like to thank \textit{Niels Gustav Westphal Serup}, who
has been helpful with giving me Haskell advice, at times where I have been stuck
in developement.
\vfill
NÃ¥. Hej hej!
